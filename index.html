<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moralis Wallet Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <py-config>
        packages = ["moralis"]
    </py-config>
</head>
<body>
    <!-- Header similar to Python Quest -->
    <div class="border-b border-gray-800 py-4">
        <div class="container mx-auto px-4 flex items-center">
            <div class="flex items-center">
                <div class="bg-primary rounded-lg p-2 mr-3">
                    <i class="fas fa-wallet text-background text-xl"></i>
                </div>
                <div>
                    <h1 class="text-primary text-xl font-bold m-0">Moralis Wallet Explorer</h1>
                    <p class="text-xs text-text-secondary m-0">Explore blockchain data with Python</p>
                </div>
            </div>
            <div class="ml-auto">
                <button class="btn-accent text-sm py-1 px-3">
                    <i class="fas fa-star mr-1"></i> Powered by PyScript
                </button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Level and progress section -->
        <div class="card mb-6">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center">
                    <div class="level-indicator">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <span class="text-text-secondary">Explorer Level</span>
                </div>
                <div class="text-accent font-bold">
                    1
                </div>
            </div>
            
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-text-secondary">Overall Progress</span>
                    <span class="text-text-secondary">0 / 4 Features</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 25%;"></div>
                </div>
            </div>
            
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-text-secondary">XP to Level 2</span>
                    <span class="text-text-secondary">0 / 100 XP</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%;"></div>
                </div>
            </div>
        </div>

        <!-- Main content section -->
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold mb-2">Master Blockchain Exploration</h2>
            <p class="text-lg">Check wallet balances across multiple blockchains with Python</p>
            
            <div class="flex justify-center mt-6 space-x-6">
                <div class="flex items-center">
                    <i class="fas fa-wallet text-primary mr-2"></i>
                    <span class="text-text-secondary">Multi-Chain Support</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-code text-primary mr-2"></i>
                    <span class="text-text-secondary">Python-Powered</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-bolt text-accent mr-2"></i>
                    <span class="text-text-secondary">Low Latency</span>
                </div>
            </div>
        </div>

        <!-- Wallet explorer card -->
        <div class="max-w-xl mx-auto">
            <div class="card p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Wallet Balance Checker</h3>
                    <div class="star-rating">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <p class="text-text-secondary mb-4">Enter any wallet address to check its native balance</p>
                
                <form id="wallet-form" class="space-y-4">
                    <div>
                        <label for="wallet-address">Wallet Address</label>
                        <input type="text" id="wallet-address" placeholder="Enter wallet address (0x...)" required>
                    </div>
                    <div>
                        <label for="chain">Blockchain</label>
                        <select id="chain" required>
                            <option value="eth">Ethereum</option>
                            <option value="bsc">Binance Smart Chain</option>
                            <option value="polygon">Polygon</option>
                            <option value="avalanche">Avalanche</option>
                            <option value="fantom">Fantom</option>
                            <option value="cronos">Cronos</option>
                        </select>
                    </div>
                    <div class="flex items-center">
                        <button type="submit" class="btn-primary flex-grow">Check Balance</button>
                        <div id="loading" class="loading ml-3"></div>
                    </div>
                </form>
            </div>

            <div id="result-box" class="card p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Wallet Balance</h3>
                    <div class="star-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <div id="result-content" class="result-container pl-4 py-2">
                    <p id="wallet-info" class="mb-2 text-text-secondary"></p>
                    <div class="flex justify-between items-center">
                        <span class="text-lg">Native Balance:</span>
                        <span id="balance-value" class="balance-value"></span>
                    </div>
                    <p id="balance-usd" class="text-right text-text-secondary text-sm"></p>
                </div>
            </div>
        </div>

        <!-- Feature cards (locked) -->
        <div class="max-w-4xl mx-auto mt-12">
            <h3 class="text-xl font-semibold mb-6 text-center">Coming Soon</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Token Balance Card -->
                <div class="card p-6 opacity-75">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold">Token Balances</h4>
                        <div class="star-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <p class="text-text-secondary mb-4">View all ERC-20 tokens in a wallet</p>
                    <div class="text-center mt-6">
                        <i class="fas fa-lock text-text-secondary text-2xl"></i>
                    </div>
                </div>
                
                <!-- NFT Card -->
                <div class="card p-6 opacity-75">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold">NFT Gallery</h4>
                        <div class="star-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <p class="text-text-secondary mb-4">Explore NFTs owned by an address</p>
                    <div class="text-center mt-6">
                        <i class="fas fa-lock text-text-secondary text-2xl"></i>
                    </div>
                </div>
                
                <!-- Transaction History Card -->
                <div class="card p-6 opacity-75">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold">Transaction History</h4>
                        <div class="star-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <p class="text-text-secondary mb-4">View recent transactions for any wallet</p>
                    <div class="text-center mt-6">
                        <i class="fas fa-lock text-text-secondary text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <py-script>
import json
from js import document, console
from pyodide.ffi import create_proxy
from moralis import evm_api

# Moralis API key - In production, this should be secured properly
API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJub25jZSI6ImFhZTUyYzI4LTc3YjMtNGQ4NC1iMTdhLWY5NzE4NmNjMGU5MyIsIm9yZ0lkIjoiMzA0ODYzIiwidXNlcklkIjoiMzEyOTkzIiwidHlwZUlkIjoiMzIwMjdkMDAtYWNhYS00YTFmLTk4NWMtMWQxMzJkZTVmZGQ4IiwidHlwZSI6IlBST0pFQ1QiLCJpYXQiOjE2ODk1NDI3NDUsImV4cCI6NDg0NTMwMjc0NX0.g-mbcVZbLwTPNJXihBOaJ0WR3wpZTmkTeF8wo-cQQCg"

# Chain symbols to display names mapping
CHAIN_NAMES = {
    "eth": "Ethereum",
    "bsc": "Binance Smart Chain",
    "polygon": "Polygon",
    "avalanche": "Avalanche",
    "fantom": "Fantom",
    "cronos": "Cronos"
}

# Format balance to be more readable
def format_balance(balance_wei, decimals=18):
    balance = int(balance_wei) / (10 ** decimals)
    if balance < 0.000001 and balance > 0:
        return f"{balance:.8f}"
    return f"{balance:.6f}"

# Handle form submission
def check_balance(event):
    event.preventDefault()
    
    # Show loading indicator
    document.getElementById("loading").style.display = "block"
    document.getElementById("result-box").classList.add("hidden")
    
    # Get form values
    address = document.getElementById("wallet-address").value
    chain = document.getElementById("chain").value
    
    try:
        # Prepare parameters for Moralis API call
        params = {
            "address": address,
            "chain": chain,
        }
        
        # Call Moralis API to get native balance
        result = evm_api.balance.get_native_balance(
            api_key=API_KEY,
            params=params,
        )
        
        # Display results
        document.getElementById("wallet-info").innerText = f"Address: {address[:6]}...{address[-4:]}"
        document.getElementById("balance-value").innerText = f"{format_balance(result['balance'])} {get_native_symbol(chain)}"
        document.getElementById("result-box").classList.remove("hidden")
    except Exception as e:
        console.error(f"Error: {str(e)}")
        document.getElementById("result-content").innerHTML = f"<p class='text-red-500'>Error: {str(e)}</p>"
        document.getElementById("result-box").classList.remove("hidden")
    finally:
        # Hide loading indicator
        document.getElementById("loading").style.display = "none"

# Get native token symbol based on chain
def get_native_symbol(chain):
    symbols = {
        "eth": "ETH",
        "bsc": "BNB",
        "polygon": "MATIC",
        "avalanche": "AVAX",
        "fantom": "FTM",
        "cronos": "CRO"
    }
    return symbols.get(chain, "")

# Add event listener to form
form = document.getElementById("wallet-form")
form.addEventListener("submit", create_proxy(check_balance))
    </py-script>
</body>
</html>
